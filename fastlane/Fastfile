fastlane_version "2.68.0"

generated_fastfile_id "374a945e-9ada-4130-a843-eb8e4b220bd3"

default_platform :ios

desc "Runs all the tests"
lane :test do
    scan(scheme: "CaronaDev")
end

desc "Submit a new Beta Build to Apple TestFlight"
desc "This will also make sure the profile is up to date"
lane :beta do
    # Ensure that your git status is not dirty
    ensure_git_status_clean

    # increment_build_number
    build_number = increment_build_number(xcodeproj: "Carona.xcodeproj")

    # build your iOS app
    gym(scheme: "CaronaProd", workspace: "Carona.xcworkspace", include_bitcode: true)

    # upload to Testflight
    changelog_from_git_commits
    upload_to_testflight(skip_waiting_for_build_processing: true)

    # Add a git tag for this build. This will automatically
    # use an appropriate git tag name
    add_git_tag

    # Commit the version bump
    commit_version_bump(message: "Deploying build #{build_number} to Testflight.", xcodeproj: "Carona.xcodeproj")

    # Push the new commit and tag back to your git remote
    push_to_git_remote(force: true)
end

desc "Deploy a new version to the App Store"
lane :release do
    sync_code_signing

    # snapshot
    capture_screenshots(reinstall_app: true, app_identifier: "br.com.jjfernandes87.Carona", skip_open_summary: true)

    # upload screenshots to iTunes Connect
    upload_to_app_store

    # build your iOS app
    build_app(scheme: "CaronaProd", workspace: "Carona.xcworkspace", include_bitcode: true)

    deliver(force: true)
    # frameit
end
